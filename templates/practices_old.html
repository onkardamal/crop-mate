<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CropMate - Best Practices</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .practice-card {
            border: none;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }
        
        .practice-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .practice-header {
            background: var(--gradient-primary);
            color: var(--white);
            padding: var(--spacing-lg);
            text-align: center;
        }
        
        .practice-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            color: var(--accent-color);
        }
        
        .practice-content {
            padding: var(--spacing-lg);
        }
        
        .practice-step {
            background: var(--light-gray);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-left: 4px solid var(--primary-color);
        }
        
        .practice-step h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }
        
        .tip-box {
            background: linear-gradient(135deg, #FFF3CD 0%, #FFEAA7 100%);
            border: 1px solid var(--warning);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }
        
        .warning-box {
            background: linear-gradient(135deg, #F8D7DA 0%, #F5C6CB 100%);
            border: 1px solid var(--danger);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }
        
        .success-box {
            background: linear-gradient(135deg, #D4EDDA 0%, #C3E6CB 100%);
            border: 1px solid var(--success);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }
        
        .crop-selector {
            background: var(--gradient-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            text-align: center;
        }
        
        .crop-option {
            display: inline-block;
            margin: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--white);
            border: 2px solid var(--light-gray);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            font-weight: 500;
        }
        
        .crop-option:hover,
        .crop-option.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: var(--white);
            transform: translateY(-2px);
        }
        
        .practice-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }
        
        .timeline {
            position: relative;
            padding-left: var(--spacing-lg);
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--primary-color);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -var(--spacing-lg);
            top: var(--spacing-sm);
            width: 12px;
            height: 12px;
            background: var(--primary-color);
            border-radius: 50%;
            border: 3px solid var(--white);
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark" aria-label="Main navigation">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">
            <i class="bi bi-flower1"></i> CropMate
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/recommend">Crop Recommendation</a></li>
                <li class="nav-item"><a class="nav-link" href="/compare">Compare Crops</a></li>
                <li class="nav-item"><a class="nav-link" href="/profitability">Profitability Calculator</a></li>
                <li class="nav-item"><a class="nav-link" href="/calendar">Seasonal Calendar</a></li>
                <li class="nav-item"><a class="nav-link active" href="/practices">Best Practices</a></li>
                <li class="nav-item"><a class="nav-link" href="/suitability">Local Suitability</a></li>
                <li class="nav-item"><a class="nav-link" href="/schemes">Schemes & Support</a></li>
                <li class="nav-item"><a class="nav-link" href="/market">Market Trends</a></li>
                <li class="nav-item"><a class="nav-link" href="/community">Community</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="page-header">
        <h1><i class="bi bi-lightbulb"></i> Best Practices</h1>
        <p class="subtitle">Discover science-backed, field-tested best practices to boost your crop yield, protect your soil, and farm sustainably</p>
    </div>
    
    <!-- Crop Selector -->
    <div class="crop-selector" style="position:sticky;top:1rem;z-index:10;">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h4><i class="bi bi-search"></i> Select a Crop for Specific Practices</h4>
                <p class="mb-0">Choose a crop to get detailed growing tips, common problems, and solutions</p>
            </div>
            <div class="col-md-4">
                <select id="cropSelect" class="form-select form-select-lg">
                    <option value="">Select a crop...</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Navigation Pills -->
    <ul class="nav nav-pills mb-4" id="practicesTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="general-tab" data-bs-toggle="pill" data-bs-target="#general" type="button" role="tab">
                <i class="bi bi-globe"></i> General Practices
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="crop-specific-tab" data-bs-toggle="pill" data-bs-target="#crop-specific" type="button" role="tab">
                <i class="bi bi-plant"></i> Crop-Specific
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="seasonal-tab" data-bs-toggle="pill" data-bs-target="#seasonal" type="button" role="tab">
                <i class="bi bi-calendar3"></i> Seasonal Tips
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="problems-tab" data-bs-toggle="pill" data-bs-target="#problems" type="button" role="tab">
                <i class="bi bi-exclamation-triangle"></i> Common Problems
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="practicesTabContent">
        <!-- General Practices Tab -->
        <div class="tab-pane fade show active" id="general" role="tabpanel">
            <div class="row">
                <div class="col-md-6">
                    <div class="practice-card card">
                        <div class="card-body">
                            <h5 class="card-title"><i class="bi bi-droplet"></i> Water Management</h5>
                            <div class="tip-item">
                                <strong>Drip Irrigation:</strong> Use drip irrigation for water conservation and efficient nutrient delivery.
                            </div>
                            <div class="tip-item">
                                <strong>Mulching:</strong> 
                                <span data-bs-toggle="tooltip" title="Covering soil with organic material to retain moisture and suppress weeds.">What is this?</span>
                                Apply organic mulch to retain soil moisture and reduce evaporation.
                            </div>
                            <div class="tip-item">
                                <strong>Water Scheduling:</strong> Water early morning or evening to minimize evaporation losses.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="practice-card card">
                        <div class="card-body">
                            <h5 class="card-title"><i class="bi bi-flower2"></i> Soil Health</h5>
                            <div class="tip-item">
                                <strong>Crop Rotation:</strong> Rotate crops to prevent soil-borne diseases and maintain fertility.
                            </div>
                            <div class="tip-item">
                                <strong>Organic Matter:</strong> Add compost and organic matter to improve soil structure.
                            </div>
                            <div class="tip-item">
                                <strong>pH Testing:</strong> Regularly test soil pH and adjust as needed for optimal crop growth.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="practice-card card">
                        <div class="card-body">
                            <h5 class="card-title"><i class="bi bi-bug"></i> Pest Management</h5>
                            <div class="tip-item">
                                <strong>Integrated Pest Management:</strong> Use biological controls and natural predators.
                            </div>
                            <div class="tip-item">
                                <strong>Regular Monitoring:</strong> Check crops regularly for early pest detection.
                            </div>
                            <div class="tip-item">
                                <strong>Resistant Varieties:</strong> Choose pest-resistant crop varieties when available.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="practice-card card">
                        <div class="card-body">
                            <h5 class="card-title"><i class="bi bi-sun"></i> Climate Adaptation</h5>
                            <div class="tip-item">
                                <strong>Weather Monitoring:</strong> Stay updated with local weather forecasts.
                            </div>
                            <div class="tip-item">
                                <strong>Shade Structures:</strong> Use shade nets for heat-sensitive crops.
                            </div>
                            <div class="tip-item">
                                <strong>Wind Breaks:</strong> Plant wind breaks to protect crops from strong winds.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crop-Specific Tab -->
        <div class="tab-pane fade" id="crop-specific" role="tabpanel">
            <div id="cropSpecificContent">
                <div class="text-center">
                    <i class="bi bi-arrow-up-circle" style="font-size: 4rem; color: #6c757d;"></i>
                    <p class="mt-3">Select a crop from the dropdown above to view specific practices</p>
                </div>
            </div>
        </div>

        <!-- Seasonal Tips Tab -->
        <div class="tab-pane fade" id="seasonal" role="tabpanel">
            <div class="row">
                <div class="col-md-4">
                    <div class="seasonal-tip">
                        <h5><i class="bi bi-sun"></i> Summer (March-June)</h5>
                        <ul>
                            <li>Plant heat-tolerant crops like cotton, maize</li>
                            <li>Increase irrigation frequency</li>
                            <li>Use shade nets for sensitive crops</li>
                            <li>Harvest early morning to avoid heat stress</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="seasonal-tip">
                        <h5><i class="bi bi-cloud-rain"></i> Monsoon (July-September)</h5>
                        <ul>
                            <li>Plant rice, pulses, and vegetables</li>
                            <li>Ensure proper drainage</li>
                            <li>Monitor for fungal diseases</li>
                            <li>Use raised beds for waterlogging prevention</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="seasonal-tip">
                        <h5><i class="bi bi-snow"></i> Winter (October-February)</h5>
                        <ul>
                            <li>Plant wheat, mustard, peas</li>
                            <li>Protect from frost damage</li>
                            <li>Use row covers for early crops</li>
                            <li>Reduce irrigation frequency</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Common Problems Tab -->
        <div class="tab-pane fade" id="problems" role="tabpanel">
            <div class="row">
                <div class="col-md-6">
                    <div class="practice-card card">
                        <div class="card-body">
                            <h5 class="card-title text-danger"><i class="bi bi-exclamation-triangle"></i> Common Issues</h5>
                            <div class="warning-item">
                                <strong>Yellowing Leaves:</strong> Usually indicates nitrogen deficiency or overwatering
                            </div>
                            <div class="warning-item">
                                <strong>Stunted Growth:</strong> Check for root damage, poor soil, or nutrient deficiency
                            </div>
                            <div class="warning-item">
                                <strong>Wilting:</strong> Could be underwatering, root rot, or heat stress
                            </div>
                            <div class="warning-item">
                                <strong>Poor Flowering:</strong> Often due to insufficient light or phosphorus deficiency
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="practice-card card">
                        <div class="card-body">
                            <h5 class="card-title text-success"><i class="bi bi-check-circle"></i> Solutions</h5>
                            <div class="tip-item">
                                <strong>Nutrient Deficiency:</strong> Apply balanced fertilizers based on soil tests
                            </div>
                            <div class="tip-item">
                                <strong>Pest Control:</strong> Use neem oil, soap sprays, or beneficial insects
                            </div>
                            <div class="tip-item">
                                <strong>Disease Prevention:</strong> Ensure proper spacing and air circulation
                            </div>
                            <div class="tip-item">
                                <strong>Water Issues:</strong> Adjust irrigation schedule and improve drainage
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Load crops into dropdown
async function loadCrops() {
    try {
        const response = await fetch('/api/crops');
        const crops = await response.json();
        const select = document.getElementById('cropSelect');
        
        crops.forEach(crop => {
            const option = document.createElement('option');
            option.value = crop;
            option.textContent = crop;
            select.appendChild(option);
        });
    } catch (error) {
        console.error('Error loading crops:', error);
    }
}

// Load crop-specific practices
async function loadCropPractices(cropName) {
    const contentDiv = document.getElementById('cropSpecificContent');
    contentDiv.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"></div><p class="mt-2">Loading practices...</p></div>';
    
    try {
        const response = await fetch(`/api/crops/${cropName}`);
        const cropData = await response.json();
        
        if (response.ok) {
            contentDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center mb-3">
                            <img src="/static/images/${cropData.image}" alt="${cropName} image" class="crop-image">
                            <h4>${cropName}</h4>
                        </div>
                        <div class="practice-card card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-info-circle"></i> Description</h5>
                                <p>${cropData.description}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="practice-card card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-lightbulb"></i> Growing Tips</h5>
                                <ul class="list-unstyled">
                                    ${cropData.growing_tips.map(tip => `<li class="tip-item"><i class="bi bi-check-circle text-success"></i> ${tip}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="practice-card card">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="bi bi-calendar"></i> Growing Season</h5>
                                        <p class="info-item">${cropData.growing_season}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="practice-card card">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="bi bi-droplet"></i> Water Requirements</h5>
                                        <p class="info-item">${cropData.water_requirements}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="practice-card card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-geo-alt"></i> Suitable Regions</h5>
                                <div class="d-flex flex-wrap">
                                    ${cropData.regions.map(region => `<span class="badge bg-primary me-2 mb-2">${region}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        } else {
            contentDiv.innerHTML = '<div class="alert alert-danger">Error loading crop data</div>';
        }
    } catch (error) {
        contentDiv.innerHTML = '<div class="alert alert-danger">Error loading crop data</div>';
        console.error('Error:', error);
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    loadCrops();
    
    document.getElementById('cropSelect').addEventListener('change', function() {
        const selectedCrop = this.value;
        if (selectedCrop) {
            loadCropPractices(selectedCrop);
            // Switch to crop-specific tab
            const cropSpecificTab = document.getElementById('crop-specific-tab');
            const tab = new bootstrap.Tab(cropSpecificTab);
            tab.show();
        }
    });
});

// Enable tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
tooltipTriggerList.forEach(function (tooltipTriggerEl) {
  new bootstrap.Tooltip(tooltipTriggerEl);
});

// Highlight current season in seasonal tips
const month = new Date().getMonth() + 1;
let season = '';
if ([3,4,5,6].includes(month)) season = 'Summer';
else if ([7,8,9].includes(month)) season = 'Monsoon';
else season = 'Winter';
document.querySelectorAll('.seasonal-tip').forEach(tip => {
    if (tip.innerText.includes(season)) tip.classList.add('border', 'border-success', 'shadow');
});
</script>
</body>
</html> 